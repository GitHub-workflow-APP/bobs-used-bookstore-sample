@using System.Globalization
@{
    ViewData["Title"] = "Process Orders";
}
@model AdminSite.ViewModel.ProcessOrders.ProcessOrderViewModel;
@{
    var fullOrder = Model.FullOrder;

    var orderStatus = Model.Statuses;

    var orderStatusWidth = fullOrder.Order.OrderStatus.Position switch
    {
        1 => "25%",
        2 => "50%",
        3 => "75%",
        4 => "100%",
        _ => "0"
    };
}
<head>
    <link rel="stylesheet" href="/css/Orders/processorders.css"/>
</head>
<div class="container">
    <div class="text-center">
        <h2 class="website-text">Process Order</h2>
        @if (!string.IsNullOrEmpty(Model.ErrorMessage))
        {
            <div class="alert alert-secondary alert-dismissible fade show" role="alert">
                @Model.ErrorMessage
                <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
        }
    </div>

    <div class="progress progress-bar-empty">
        <div id="order-status-progress-bar" style="width:@orderStatusWidth;" class="progress-bar progress-bar-filled" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>

    </div>

    <div class="row justify-content-center">
        <div class="text-left col-3">
            <a asp-controller="Orders" asp-action="Index" class="btn shadow manage-order-button website-text">
                <svg class="bi bi-chevron-left" width="24" height="24" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                    <path fill-rule="evenodd" d="M11.354 1.646a.5.5 0 0 1 0 .708L5.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0z"/>
                </svg>
                Manage Orders
            </a>
        </div>
        <div class="text-center col-4 website-text">
            <h3>Status: @fullOrder.Order.OrderStatus.Status</h3>
        </div>
        <div class="col-3 text-right">
            <partial name="./Partials/_UpdateOrderStatus" model="Model"/>
        </div>
    </div>

    <div class="row justify-content-center" style="margin-top:35px">

        <div class="col-2">
            <partial name="./Partials/_OrderInfo" model="fullOrder"/>
        </div>

        <div class="col-4">
            <partial name="./Partials/_CustomerInfo" model="fullOrder"/>
        </div>

        <div class="col-4">
            <partial name="./Partials/_AddressInfo" model="fullOrder"/>
        </div>
    </div>

    <div>
        <p class="website-text">Expected Delivery Date: @(fullOrder.Order.DeliveryDate == null ? "Pending Confirmation" : DateTime.ParseExact(fullOrder.Order.DeliveryDate, "dd/MM/yyyy", CultureInfo.InvariantCulture).ToString("MM/dd/yyyy"))</p>
        @if (Model.FullOrder.OrderDetails.Count() == Model.FullOrder.ItemsRemoved && Model.FullOrder.Order.OrderStatus.Status != "Cancelled")
        {
            var cancelId = Model.Statuses.FirstOrDefault(o => o.Status == "Cancelled").OrderStatus_Id;

            var data = new Dictionary<string, string>
            {
                { "orderId", "" + Model.FullOrder.Order.Id },
                { "status", "" + cancelId },
                { "oldStatus", "" + Model.FullOrder.Order.OrderStatus.OrderStatus_Id }
            };
            <a asp-controller="Orders" asp-action="UpdateOrderStatus" asp-all-route-data="data" style="padding-top:.8rem; margin-left:.7rem;" class=" filter-pill badge badge-pill text-white">Cancel Order</a>
        }
    </div>
    <div>
        <partial name="./Partials/_BookList" model="fullOrder"/>
    </div>

</div>
